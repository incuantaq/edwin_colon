---
import Cotizacion from "./Cotizacion";
---

<form id="cotizador" class="flex flex-col flex-wrap md:flex-row container mx-auto py-10 pricer-wrapper">
  <div class="w-full md:w-1/2 md:pr-5 md:min-h-[65vh]">
    <h3 class="pb-4 font-bold text-xl">Información de contacto</h3>
    
    <p class="text-md mb-4">Recuerda puedes ser el felíz ganador de un viaje con todo incluido a Punta Cana.</p>
    
    <div>
      <input type="text" id="full_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 mb-3" placeholder="Nombre completo" required />
      <input type="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 mb-3" placeholder="Email" required />
      <input type="tel" id="phone" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 mb-3" placeholder="Telefono" required />
      <input type="text" id="address" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 mb-3" placeholder="Dirección" required />
    </div>
    <div class="text-center md:text-left w-full mt-6">
      <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Cotizar</button>
    </div>
  </div>
  <Cotizacion client:load />
</form>

<!-- Zoho CRM Form - Hidden -->
<div id='crmWebToEntityForm' class='zcwf_lblLeft crmWebToEntityForm' style='display: none;'>
  <form id='webform6452183000000501004' action='https://crm.zoho.com/crm/WebToLeadForm' name=WebToLeads6452183000000501004 method='POST' accept-charset='UTF-8'>
    <input type='text' style='display:none;' name='xnQsjsdp' value='315b6fef7e2b591e2ab85e8105388069872b85f4e9b3cce2dfe4034fcd765429'></input> 
    <input type='hidden' name='zc_gad' id='zc_gad' value=''></input>
    <input type='text' style='display:none;' name='xmIwtLD' value='b996b56ff34ed038f05f2cd8769a4a84592c6736396f7d034b0c8def6d9293b89c002f71b85c559205c37fb59aca6d31'></input> 
    <input type='text' style='display:none;' name='actionType' value='TGVhZHM='></input>
    <input type='text' style='display:none;' name='returnURL' value='https&#x3a;&#x2f;&#x2f;pr-solarenergy.com&#x2f;thank-you'></input>
    
    <input type='text' id='First_Name' name='First Name' maxlength='40'></input>
    <input type='text' id='Last_Name' name='Last Name' maxlength='80'></input>
    <input type='text' id='Email' name='Email' maxlength='100'></input>
    <input type='text' id='Phone' name='Phone' maxlength='30'></input>
    <input type='text' id='Street' name='Street' maxlength='250'></input>
    <select id='Lead_Source' name='Lead Source'>
      <option selected value='Online Store'>Online Store</option>
    </select>
    <textarea id='Description' name='Description'></textarea>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const cotizadorForm = document.getElementById('cotizador');
    const zohoForm = document.getElementById('webform6452183000000501004') as HTMLFormElement;

    function validateEmail(email: string) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function validateForm(formData: {
      fullName: string,
      email: string,
      phone: string,
      address: string
    }) {
      if (!formData.fullName || formData.fullName.trim().length === 0) {
        alert('Por favor ingrese su nombre completo');
        return false;
      }
      
      if (!formData.email || !validateEmail(formData.email)) {
        alert('Por favor ingrese un email válido');
        return false;
      }
      
      if (!formData.phone || formData.phone.trim().length < 10) {
        alert('Por favor ingrese un número de teléfono válido');
        return false;
      }
      
      if (!formData.address || formData.address.trim().length === 0) {
        alert('Por favor ingrese su dirección');
        return false;
      }
      
      return true;
    }

    cotizadorForm.addEventListener('submit', function(e) {
      e.preventDefault();

      const formData = {
        fullName: (document.getElementById('full_name') as HTMLInputElement).value,
        email: (document.getElementById('email') as HTMLInputElement).value,
        phone: (document.getElementById('phone') as HTMLInputElement).value,
        address: (document.getElementById('address') as HTMLInputElement).value
      };

      if (!validateForm(formData)) {
        return;
      }

      // Split full name into first and last name
      const nameParts = formData.fullName.split(' ');
      const firstName = nameParts[0];
      const lastName = nameParts.slice(1).join(' ') || firstName;

      // Fill Zoho form
      (zohoForm.querySelector('#First_Name') as HTMLInputElement).value = firstName;
      (zohoForm.querySelector('#Last_Name') as HTMLInputElement).value = lastName;
      (zohoForm.querySelector('#Email') as HTMLInputElement).value = formData.email;
      (zohoForm.querySelector('#Phone') as HTMLInputElement).value = formData.phone;
      (zohoForm.querySelector('#Street') as HTMLInputElement).value = formData.address;

      // Get selected product
      const selectedProduct = document.querySelector('.product-picker.selected') as HTMLElement;
      const productName = selectedProduct ? selectedProduct.textContent : 'No product selected';

      // Set description
      (zohoForm.querySelector('#Description') as HTMLTextAreaElement).value = `Producto de interés: ${productName}`;

      // Submit Zoho form
      zohoForm.submit();
    });
  });
</script>